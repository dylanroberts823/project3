{% extends "orders/base.html" %}

{% block body %}
  <h1>Menu</h1>
    {% for category in Category %}
      <h2>  {{ category }} </h2>
      <ul>
        {% for item in Item %}
          {% if item.category == category %}
            <li>
              {{ item }}
              <label for="quantity">Quantity:</label>
              <input type="number" data-item="{{ item }}" data-category="{{ category }}" min="0"></input>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    {% endfor %}
    <button id="shopping_cart" class="btn btn-primary" href="{% url 'select_toppings' %}">Select Toppings</button>
    <script>
      //If there isn't a shopping cart already, create one
      if(!localStorage.getItem('shopping_cart')){
        var shopping_cart = [];
        localStorage.setItem('shopping_cart', shopping_cart);
      };
    </script>
    <script>
    //Dictates what to do on click
    document.addEventListener('DOMContentLoaded', () => {
      const cart_button = document.getElementById('shopping_cart');
      cart_button.onclick = (() => {
        //Create variable to store current cart
        var current_cart = [];

        //Populate that variable
        document.querySelectorAll('input').forEach(input => {
          //Select for those items that have a quantity
          if (input.value != "" || input.value != "") {
            //Add their information to the current_cart
            var item = {
              "Category": input.dataset.category,
              "Item": input.dataset.item,
              "Quantity": parseInt(input.value),
            };
            current_cart.push(item);
          }
        });
        //Store the variable
        localStorage.setItem('shopping_cart', current_cart);
        window.location.href="{% url 'select_toppings' %}";
      });
    });
    </script>
{% endblock %}
